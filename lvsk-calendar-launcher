#!/bin/bash

# Opens the calendar in a properly configured floating terminal
# No Hyprland configuration required - windowrules are added dynamically

# Determine the calendar script location
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [ -f "${SCRIPT_DIR}/lvsk-calendar" ]; then
    # Running from development directory
    CALENDAR_SCRIPT="${SCRIPT_DIR}/lvsk-calendar"
else
    # Running from installed package
    CALENDAR_SCRIPT="/usr/bin/lvsk-calendar"
fi

# Add temporary windowrules for Hyprland (only if running in Hyprland)
if [ -n "$HYPRLAND_INSTANCE_SIGNATURE" ]; then
    # Hyprland 0.53+ syntax
    hyprctl keyword windowrule "float on, match:title ^lvsk-calendar$" 2>/dev/null
    hyprctl keyword windowrule "size 600 500, match:title ^lvsk-calendar$" 2>/dev/null
    hyprctl keyword windowrule "center on, match:title ^lvsk-calendar$" 2>/dev/null
fi

# Detect terminal emulator and launch with proper title
# LAUNCHED_BY_LAUNCHER tells the calendar to close the terminal window on exit
if command -v ghostty &> /dev/null; then
    ghostty --title="lvsk-calendar" -e env LAUNCHED_BY_LAUNCHER=1 "${CALENDAR_SCRIPT}"
elif command -v kitty &> /dev/null; then
    kitty --title="lvsk-calendar" -e env LAUNCHED_BY_LAUNCHER=1 "${CALENDAR_SCRIPT}"
elif command -v alacritty &> /dev/null; then
    alacritty --title="lvsk-calendar" -e env LAUNCHED_BY_LAUNCHER=1 "${CALENDAR_SCRIPT}"
elif command -v foot &> /dev/null; then
    foot --title="lvsk-calendar" env LAUNCHED_BY_LAUNCHER=1 "${CALENDAR_SCRIPT}"
elif command -v wezterm &> /dev/null; then
    wezterm start --class="lvsk-calendar" -- env LAUNCHED_BY_LAUNCHER=1 "${CALENDAR_SCRIPT}"
else
    echo "Error: No supported terminal emulator found (ghostty, kitty, alacritty, foot, wezterm)"
    exit 1
fi
