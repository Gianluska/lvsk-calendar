#!/bin/bash

# lvsk calendar - Minimalist aesthetic calendar
# Ultra-clean design with pastel monochromatic palette
#
# Architecture:
#   - Modular design with separated concerns
#   - Clean component-based UI rendering
#   - Clear separation between data, presentation, and logic

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Source all modules in dependency order
source "${SCRIPT_DIR}/src/config.sh"
source "${SCRIPT_DIR}/src/utils.sh"
source "${SCRIPT_DIR}/src/ui/background.sh"
source "${SCRIPT_DIR}/src/ui/header.sh"
source "${SCRIPT_DIR}/src/ui/calendar.sh"
source "${SCRIPT_DIR}/src/ui/footer.sh"
source "${SCRIPT_DIR}/src/navigation.sh"
source "${SCRIPT_DIR}/src/input.sh"

# Setup cleanup trap
trap cleanup_terminal EXIT INT TERM

# Main render function
render() {
    if [ $FIRST_RENDER -eq 1 ]; then
        # First render: draw everything including background
        clear
        draw_background
        FIRST_RENDER=0
    fi

    # Move cursor to home position (fast, no clearing)
    tput home

    draw_header
    draw_day_headers
    draw_calendar
    draw_footer
}

# Application entry point
main() {
    setup_terminal
    setup_hyprland
    show_splash

    # Main event loop
    while true; do
        render
        handle_input
    done
}

# Start application
main
